<!DOCTYPE html>
<html>
<head>
    <title>Call Hierarchy Graph</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; }
        #cy {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }
        /* 你可以添加一些控制面板的CSS */
    </style>
    <!-- 引入 Cytoscape.js -->
    <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
    <!-- 也可以引入布局算法，例如 cola -->
    <script src="https://unpkg.com/cytoscape-cola/cytoscape-cola.js"></script>
</head>
<body>
<div id="cy"></div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 这就是我们的数据契约！
        const graphData = '{graph_data_placeholder}';

        const cy = cytoscape({
            container: document.getElementById('cy'), // 渲染容器

            // 1. 定义元素 (节点和边)
            elements: {
                nodes: graphData.nodes.map(node => ({
                    data: {
                        id: node.id,
                        label: `${node.className}\n${node.methodName}`,
                        ...node // 将所有节点数据附加到 data 对象
                    }
                })),
                edges: graphData.edges.map(edge => ({
                    data: {
                        id: `${edge.source}-${edge.target}`,
                        source: edge.source,
                        target: edge.target
                    }
                }))
            },

            // 2. 定义样式
            style: [
                {
                    selector: 'node',
                    style: {
                        'background-color': 'data(classColor)', // 使用后端传来的颜色
                        'label': 'data(label)',
                        'text-wrap': 'wrap',
                        'text-valign': 'center',
                        'font-size': '10px',
                        'color': '#fff',
                        'text-outline-width': 2,
                        'text-outline-color': 'data(classColor)'
                    }
                },
                {
                    selector: 'edge',
                    style: {
                        'width': 2,
                        'line-color': '#ccc',
                        'target-arrow-color': '#ccc',
                        'target-arrow-shape': 'triangle',
                        'curve-style': 'bezier'
                    }
                },
                // 高亮样式
                {
                    selector: '.highlighted',
                    style: {
                        'background-color': '#61bffc',
                        'line-color': '#61bffc',
                        'target-arrow-color': '#61bffc',
                        'transition-property': 'background-color, line-color, target-arrow-color',
                        'transition-duration': '0.5s'
                    }
                }
            ],

            // 3. 定义布局
            layout: {
                name: 'dagre', // 有向无环图布局，需要引入 cytoscape-dagre.js
                // 或者使用 'cola', 'breadthfirst', 'circle' 等
                rankDir: 'LR' // 从左到右
            }
        });

        // 4. 添加交互
        cy.on('tap', 'node', function(evt){
            const node = evt.target;
            cy.elements().removeClass('highlighted');
            node.successors().union(node.predecessors()).addClass('highlighted');
            node.addClass('highlighted');
        });

        cy.on('tap', function(evt){
            if(evt.target === cy){
                cy.elements().removeClass('highlighted');
            }
        });
    });
</script>
</body>
</html>
